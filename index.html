<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, width=device-width"/>
    <link rel="stylesheet" type="text/css"
          href="https://js.api.here.com/v3/3.0/mapsjs-ui.css"/>
    <script type="text/javascript" charset="UTF-8" src="https://js.api.here.com/v3/3.0/mapsjs-core.js"></script>
    <script type="text/javascript" charset="UTF-8" src="https://js.api.here.com/v3/3.0/mapsjs-service.js"></script>
    <script type="text/javascript" charset="UTF-8" src="https://js.api.here.com/v3/3.0/mapsjs-ui.js"></script>
    <script type="text/javascript" charset="UTF-8" src="https://js.api.here.com/v3/3.0/mapsjs-mapevents.js"></script>
    <script src="http://cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>
    <!--script async defer src="https://maps.google.cn/maps/api/js?key=${YOUR_GOOGLE_API_KEY}&language=en"></script-->
    <script async defer
            src="http://ditu.google.cn/maps/api/js?v=3&key=${YOUR_GOOGLE_API_KEY}&language=en"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
          integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css"
          integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous"/>

    <style type="text/css">
        .directions li span.arrow {
            display: inline-block;
            min-width: 28px;
            min-height: 28px;
            background-position: 0px;
            background-image: url("../img/arrows.png");
            position: relative;
            top: 8px;
        }

        .directions li span.depart {
            background-position: -28px;
        }

        .directions li span.rightUTurn {
            background-position: -56px;
        }

        .directions li span.leftUTurn {
            background-position: -84px;
        }

        .directions li span.rightFork {
            background-position: -112px;
        }

        .directions li span.leftFork {
            background-position: -140px;
        }

        .directions li span.rightMerge {
            background-position: -112px;
        }

        .directions li span.leftMerge {
            background-position: -140px;
        }

        .directions li span.slightRightTurn {
            background-position: -168px;
        }

        .directions li span.slightLeftTurn {
            background-position: -196px;
        }

        .directions li span.rightTurn {
            background-position: -224px;
        }

        .directions li span.leftTurn {
            background-position: -252px;
        }

        .directions li span.sharpRightTurn {
            background-position: -280px;
        }

        .directions li span.sharpLeftTurn {
            background-position: -308px;
        }

        .directions li span.rightRoundaboutExit1 {
            background-position: -616px;
        }

        .directions li span.rightRoundaboutExit2 {
            background-position: -644px;
        }

        .directions li span.rightRoundaboutExit3 {
            background-position: -672px;
        }

        .directions li span.rightRoundaboutExit4 {
            background-position: -700px;
        }

        .directions li span.rightRoundaboutPass {
            background-position: -700px;
        }

        .directions li span.rightRoundaboutExit5 {
            background-position: -728px;
        }

        .directions li span.rightRoundaboutExit6 {
            background-position: -756px;
        }

        .directions li span.rightRoundaboutExit7 {
            background-position: -784px;
        }

        .directions li span.rightRoundaboutExit8 {
            background-position: -812px;
        }

        .directions li span.rightRoundaboutExit9 {
            background-position: -840px;
        }

        .directions li span.rightRoundaboutExit10 {
            background-position: -868px;
        }

        .directions li span.rightRoundaboutExit11 {
            background-position: 896px;
        }

        .directions li span.rightRoundaboutExit12 {
            background-position: 924px;
        }

        .directions li span.leftRoundaboutExit1 {
            background-position: -952px;
        }

        .directions li span.leftRoundaboutExit2 {
            background-position: -980px;
        }

        .directions li span.leftRoundaboutExit3 {
            background-position: -1008px;
        }

        .directions li span.leftRoundaboutExit4 {
            background-position: -1036px;
        }

        .directions li span.leftRoundaboutPass {
            background-position: 1036px;
        }

        .directions li span.leftRoundaboutExit5 {
            background-position: -1064px;
        }

        .directions li span.leftRoundaboutExit6 {
            background-position: -1092px;
        }

        .directions li span.leftRoundaboutExit7 {
            background-position: -1120px;
        }

        .directions li span.leftRoundaboutExit8 {
            background-position: -1148px;
        }

        .directions li span.leftRoundaboutExit9 {
            background-position: -1176px;
        }

        .directions li span.leftRoundaboutExit10 {
            background-position: -1204px;
        }

        .directions li span.leftRoundaboutExit11 {
            background-position: -1232px;
        }

        .directions li span.leftRoundaboutExit12 {
            background-position: -1260px;
        }

        .directions li span.arrive {
            background-position: -1288px;
        }

        .directions li span.leftRamp {
            background-position: -392px;
        }

        .directions li span.rightRamp {
            background-position: -420px;
        }

        .directions li span.leftExit {
            background-position: -448px;
        }

        .directions li span.rightExit {
            background-position: -476px;
        }

        .directions li span.ferry {
            background-position: -1316px;
    </style>
</head>
<body>
<div class="container">
    <div class="row" style="padding: 5px 5px 5px 5px; border: solid 1px; border-radius: 5px;">
        <div class="col-md-10">
            <div class="row">
                <span class="col-sm-2"><b>Starting Position: </b></span>
                <div class="col-sm-8">
                    <label class="col-sm-3">Latitude,Longitude:</label>
                    <input class="col-sm-5" id="start_lat_lng" value="37.3464822,-121.9448373"
                           placeholder="37.3464822,-121.9448373"/>
                </div>
            </div>
            <div class="row">
                <span class="col-sm-2"><b>Stop Position: </b></span>
                <div class="col-sm-8">
                    <label class="col-sm-3">Latitude,Longitude:</label>
                    <input class="col-sm-5" id="stop_lat_lng" value="37.7580122,-122.494023"
                           placeholder="37.7580122,-122.494023"/>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <button id="btn_calculate" class="btn btn-primary btn-lg btn-block">Calculate Route</button>
        </div>
    </div>
    <div class="row"
         style="border: solid 1px; border-radius: 5px; margin-top: 10px; padding-left: 15px;padding-bottom: 5px;">
        <div class="row" style="padding-left: 15px;">
            <strong>Route by clicking in the map with starting and stop position.</strong>
        </div>
        <div class="col-md-8">
            <div class="row">
                <label class="col-sm-3">Selected Start Point:</label>
                <input class="col-sm-5" id="start_lat_lng_pin" disabled/>
            </div>
            <div class="row">
                <label class="col-sm-3">Selected Stop Point:</label>
                <input class="col-sm-5" id="stop_lat_lng_pin" disabled/>
            </div>
        </div>
        <div class="col-md-4">
            <div class="row" style="padding-left: 15px;">
                <button id="btn_calculate_pin" class="btn btn-success btn-lg btn-inline">Route By Selected</button>
                <button id="btn_clear_pin" class="btn btn-danger btn-lg btn-inline">Clear Selected</button>
            </div>
        </div>
    </div>
</div>
<br/>
<div class="container">
    <div class="row">
        <span style="color: #0000FF;font-weight: bolder">Blue</span> is generated by <span
            style="color: #0000FF; font-weight: bolder ">Here</span> Map, while
        <span style="color: #FF0000;font-weight: bolder">Red </span>is by <span
            style="color: #FF0000;font-weight: bolder">Google</span>
        Map, And
        <span style="color: #FFA500;font-weight: bolder">Orange </span>is by <span
            style="color: #FFA500;font-weight: bolder">Skobbler</span> Map
        <div class="pull-right">
            <label class="checkbox-inline" style="color: #0000FF; font-weight: bolder;">
                <input type="checkbox" id="cbHere" name="cbRoute" checked> Here
            </label>
            <label class="checkbox-inline" style="color: #FF0000; font-weight: bolder;">
                <input type="checkbox" id="cbGoogle" name="cbRoute" checked> Google
            </label>
            <label class="checkbox-inline" style="color: #FFA500; font-weight: bolder;">
                <input type="checkbox" id="cbSkobbler" name="cbRoute" checked> Skobbler
            </label>
        </div>
    </div>
</div>


<div id="map" style=" margin-left: 10px; width:90%; height:600px; background:grey"></div>
<div id="panelContainer" style="width:80%; left:2%; height:100%; background:inherit">
    <div id="panel"></div>
    <hr style="border-color: #000000">
    <div id="panelGoogle"></div>
    <hr style="border-color: #000000">
    <div id="panelSkobbler"></div>
</div>


<script type="text/javascript" charset="UTF-8">

    var hereRouteColor = ['rgba(0, 0, 255, 0.7)', 'rgba(0, 128, 255, 0.7)', 'rgba(0, 255, 255, 0.7)'];
    var hereRouteWidth = 12;
    var googleRouteColor = ['rgba(255, 0, 0, 0.7)', 'rgba(255, 128, 0, 0.7)', 'rgba(255, 255, 0, 0.7)'];
    var googleRouteWidth = 8;
    var skobblerRouteColor = ['rgba(255, 165, 0, 0.7)', 'rgba(255, 128, 0, 0.7)', 'rgba(255, 255, 0, 0.7)'];
    var skobblerRouteWidth = 4;

    var googleAPIKey = ${YOUR_GOOGLE_API_KEY};   // @Matt
    var skobblerAPIKey = ${YOUR_Skobbler_API_KEY};

    var addedRoute = new Map();
    var addedMarkers = [];
    /**
     * Calculates and displays a car route from the Brandenburg Gate in the centre of Berlin
     * to Friedrichstraße Railway Station.
     *
     * A full list of available request parameters can be found in the Routing API documentation.
     * see:  http://developer.here.com/rest-apis/documentation/routing/topics/resource-calculate-route.html
     *
     * @param   {H.service.Platform} platform    A stub class to access HERE services
     */
    function calculateRouteOfHere(platform, startPoint, stopPoint) {
        var router = platform.getRoutingService(),
                routeRequestParams = {
                    mode: 'fastest;car;traffic:enabled',
                    alternatives: 0,
                    representation: 'display',
                    routeattributes: 'waypoints,summary,shape,legs',
                    maneuverattributes: 'direction,action',
                    waypoint0: startPoint, //'52.5160,13.3779', // Brandenburg Gate
                    waypoint1: stopPoint, // '52.5206,13.3862'  // Friedrichstraße Railway Station
                };


        router.calculateRoute(
                routeRequestParams,
                onSuccess,
                onError
        );
    }
    /**
     * This function will be called once the Routing REST API provides a response
     * @param  {Object} result          A JSONP object representing the calculated route
     *
     * see: http://developer.here.com/rest-apis/documentation/routing/topics/resource-type-calculate-route.html
     */
    function onSuccess(result) {
        console.log(result);
        if (!result.response) {
            alert("Failed To calculate Here Route " + result.details);
            return;
        }
        console.info("result.response.route is " + result.response.route.length)
        console.info(result.response.route)
        var route = result.response.route[0];
        /*
         * The styling of the route response on the map is entirely under the developer's control.
         * A representitive styling can be found the full JS + HTML code of this example
         * in the functions below:
         */
        for (var i = 0; i < result.response.route.length; i++) {
            addRouteShapeToMap(result.response.route[i].shape, hereRouteColor[i], hereRouteWidth, "Here");
        }
        addManueversToMap(route);

        addWaypointsToPanel(route.waypoint);
        addManueversToPanel(route);
        addSummaryToPanel(route.summary);
        // ... etc.
    }

    /**
     * This function will be called if a communication error occurs during the JSON-P request
     * @param  {Object} error  The error message received.
     */
    function onError(error) {
        alert('Ooops!');
    }


    /**
     * Boilerplate map initialization code starts below:
     */

// set up containers for the map  + panel
    var mapContainer = document.getElementById('map'),
            routeInstructionsContainer = $('#panel'),
            routeInstructionsContainerGoogle = $('#panelGoogle'),
            routeInstructionsContainerSkobbler = $('#panelSkobbler');

    //Step 1: initialize communication with the platform
    var platform = new H.service.Platform({
        app_id: 'DemoAppId01082013GAL',
        app_code: 'AJKnXv84fjrb0KIHawS0Tg',
        useCIT: true,
        useHTTPS: true
    });
    var defaultLayers = platform.createDefaultLayers();

    //Step 2: initialize a map - this map is centered over Berlin
    var map = new H.Map(mapContainer,
            defaultLayers.normal.traffic, {
                center: {lat: 37.672995, lng: -122.4430033},
                zoom: 11
            });
    map.addLayer(defaultLayers.incidents);
    // Create a group that can hold map objects:
    var markerGroup = new H.map.Group();
    map.addObject(markerGroup);

    var svgMarkup =
            '<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg">' +
            '<rect stroke="white" fill="#1b468d" x="0" y="0" rx="20" ry="20" width="22" height="22" />' +
            ' <text x="12" y="18" font-size="8pt" font-family="Arial" font-weight="bold" text-anchor="middle " fill="white">Start</text>' +
            '</svg>';
    var myIcon = new H.map.Icon(svgMarkup);
    var stopIcon = new H.map.Icon('dest.png');
    // Add event listener:
    map.addEventListener('tap', function (evt) {
        // Log 'tap' and 'mouse' events:
        console.info(evt);
        var currentPointer = evt.currentPointer;
        var geoPoint = map.screenToGeo(currentPointer.viewportX, currentPointer.viewportY);
        if (bubble) {
            ui.removeBubble(bubble);
        }

        switch (currentPointer.button) {
            case H.mapevents.Pointer.Button.RIGHT:
//                if (evt.target instanceof H.map.Marker) {
//                    geoPoint = evt.target.getPosition();
//                }
                // Create an info bubble object at a specific geographic location:
//                bubble = new H.ui.InfoBubble(geoPoint, {
//                    content: geoPoint.lat + ',' + geoPoint.lng + '<br/>lat: ' + geoPoint.lat + ',<br/>lng: ' + geoPoint.lng
//                });
                // Add info bubble to the UI:
                //ui.addBubble(bubble);
                break;
            case H.mapevents.Pointer.Button.LEFT:
                console.info("markerGroup.getObjects ()");
                console.info(markerGroup.getObjects());
                if (markerGroup.getObjects().length >= 2) {
                    console.info("There are already two points, please calculate route now. Or clean up points first.");
                    return;
                }
                // Create a marker:
                var marker = new H.map.Marker(geoPoint);
                if (markerGroup.getObjects().length == 1) {
                    marker.setIcon(stopIcon);
                    $("#stop_lat_lng_pin").val(`${geoPoint.lat},${geoPoint.lng}`);
                } else if (markerGroup.getObjects().length == 0) {
                    $("#start_lat_lng_pin").val(`${geoPoint.lat},${geoPoint.lng}`);
                }
                // Add the marker to the group (which causes
                // it to be displayed on the map)
                markerGroup.addObject(marker);
                console.info("marker icon")
                console.info(marker.getPosition())
                break;
        }

    });
    //Step 3: make the map interactive
    // MapEvents enables the event system
    // Behavior implements default interactions for pan/zoom (also on mobile touch environments)
    var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

    // Create the default UI components
    var ui = H.ui.UI.createDefault(map, defaultLayers);

    // Hold a reference to any infobubble opened
    var bubble;

    /**
     * Opens/Closes a infobubble
     * @param  {H.geo.Point} position     The location on the map.
     * @param  {String} text              The contents of the infobubble.
     */
    function openBubble(position, text) {
        if (!bubble) {
            bubble = new H.ui.InfoBubble(
                    position,
                    // The FO property holds the province name.
                    {content: text});
            ui.addBubble(bubble);
        } else {
            bubble.setPosition(position);
            bubble.setContent(text);
            bubble.open();
        }
    }


    /**
     * Creates a H.map.Polyline from the shape of the route and adds it to the map.
     * @param {Object} route A route as received from the H.service.RoutingService
     */
    function addRouteShapeToMap(shape, color, width, routeKey) {
        var strip = new H.geo.Strip();
        var routeShape = shape;
        console.log("addRouteShapeToMap - " + routeKey)

        routeShape.forEach(function (point) {
            var parts = point.split(',');
            strip.pushLatLngAlt(parts[0], parts[1]);
        });

        var polyline = new H.map.Polyline(strip, {
            style: {
                lineWidth: width,
                //strokeColor: 'rgba(0, 128, 255, 0.7)'
                strokeColor: color
            }
        });
        addedRoute.set(routeKey, polyline);
        // Add the polyline to the map
        let needShow = $(`#cb${routeKey}`).is(':checked')
        if (needShow) {
            map.addObject(polyline);
            // And zoom to its bounding rectangle
            map.setViewBounds(polyline.getBounds(), true);
        }
    }


    /**
     * Creates a series of H.map.Marker points from the route and adds them to the map.
     * @param {Object} route  A route as received from the H.service.RoutingService
     */
    function addManueversToMap(route) {
        var svgMarkup = '<svg width="18" height="18" ' +
                        'xmlns="http://www.w3.org/2000/svg">' +
                        '<circle cx="8" cy="8" r="8" ' +
                        'fill="#1b468d" stroke="white" stroke-width="1"  />' +
                        '</svg>',
                dotIcon = new H.map.Icon(svgMarkup, {anchor: {x: 8, y: 8}}),
                group = new H.map.Group(),
                i,
                j;

        // Add a marker for each maneuver
        for (i = 0; i < route.leg.length; i += 1) {
            for (j = 0; j < route.leg[i].maneuver.length; j += 1) {
                // Get the next maneuver.
                maneuver = route.leg[i].maneuver[j];
                // Add a marker to the maneuvers group
                var marker = new H.map.Marker({
                            lat: maneuver.position.latitude,
                            lng: maneuver.position.longitude
                        },
                        {icon: dotIcon});
                marker.instruction = maneuver.instruction;
                group.addObject(marker);
            }
        }

        group.addEventListener('tap', function (evt) {
            map.setCenter(evt.target.getPosition());
            openBubble(evt.target.getPosition(), evt.target.instruction);
        }, false);

        // Add the maneuvers group to the map
        if ($("#cbHere").is(":checked")) {
            map.addObject(group);
        }
        addedMarkers.push(group);
    }


    /**
     * Creates a series of H.map.Marker points from the route and adds them to the map.
     * @param {Object} route  A route as received from the H.service.RoutingService
     */
    function addWaypointsToPanel(waypoints) {
        var nodeH3 = document.createElement('h3'), waypointLabels = [], i;

        for (i = 0; i < waypoints.length; i += 1) {
            waypointLabels.push(waypoints[i].label)
        }

        nodeH3.textContent = waypointLabels.join(' -> ');

        routeInstructionsContainer.empty();
        routeInstructionsContainer.append('<h3 style="color: #0000FF;">Here Map Instructions</h3>');
        routeInstructionsContainer.append(nodeH3);
    }

    /**
     * Creates a series of H.map.Marker points from the route and adds them to the map.
     * @param {Object} route  A route as received from the H.service.RoutingService
     */
    function addSummaryToPanel(summary) {
        var summaryDiv = document.createElement('div'),
                content = '';
        content += '<b>Total distance</b>: ' + summary.distance + 'm. <br/>';
        content += '<b>Travel Time</b>: ' + summary.travelTime.toMMSS() + ' (in current traffic)';


        summaryDiv.style.fontSize = 'small';
        summaryDiv.style.marginLeft = '5%';
        summaryDiv.style.marginRight = '5%';
        summaryDiv.innerHTML = content;
        routeInstructionsContainer.append(summaryDiv);
    }

    /**
     * Creates a series of H.map.Marker points from the route and adds them to the map.
     * @param {Object} route  A route as received from the H.service.RoutingService
     */
    function addManueversToPanel(route) {
        var nodeOL = document.createElement('ol'),
                i,
                j;

        nodeOL.style.fontSize = 'small';
        nodeOL.style.marginLeft = '5%';
        nodeOL.style.marginRight = '5%';
        nodeOL.className = 'directions';

        // Add a marker for each maneuver
        for (i = 0; i < route.leg.length; i += 1) {
            for (j = 0; j < route.leg[i].maneuver.length; j += 1) {
                // Get the next maneuver.
                maneuver = route.leg[i].maneuver[j];

                var li = document.createElement('li'),
                        spanArrow = document.createElement('span'),
                        spanInstruction = document.createElement('span');

                //spanArrow.className = 'arrow '  + maneuver.action;
                spanInstruction.innerHTML = maneuver.instruction;
                li.appendChild(spanArrow);
                li.appendChild(spanInstruction);

                nodeOL.appendChild(li);
            }
        }

        routeInstructionsContainer.append(nodeOL);
    }


    Number.prototype.toMMSS = function () {
        return Math.floor(this / 60) + ' minutes ' + (this % 60) + ' seconds.';
    };

    // Add Summary for Google MAP
    function addWaypointsToGooglePanel(leg) {
        var nodeH3 = document.createElement('h3'), waypointLabels = [], i;

        waypointLabels.push(leg.start_address);
        waypointLabels.push(leg.end_address);

        nodeH3.textContent = waypointLabels.join(' -> ');

        routeInstructionsContainerGoogle.empty();
        routeInstructionsContainerGoogle.append('<h3 style="color: #FF0000;">Google Map Instructions</h3>');
        routeInstructionsContainerGoogle.append(nodeH3);
    }

    function addSummaryToGooglePanel(leg) {
        var summaryDiv = document.createElement('div'),
                content = '';
        content += '<b>Total distance</b>: ' + leg.distance.value + 'm. <br/>';
        content += '<b>Travel Time</b>: ' + leg.duration.value.toMMSS() + ' (in current traffic)';


        summaryDiv.style.fontSize = 'small';
        summaryDiv.style.marginLeft = '5%';
        summaryDiv.style.marginRight = '5%';
        summaryDiv.innerHTML = content;
        routeInstructionsContainerGoogle.append(summaryDiv);
    }

    function addManueversToGooglePanel(steps) {
        var nodeOL = document.createElement('ol'), i, j;
        nodeOL.style.fontSize = 'small';
        nodeOL.style.marginLeft = '5%';
        nodeOL.style.marginRight = '5%';
        nodeOL.className = 'directions';

        // Add a marker for each maneuver
        for (i = 0; i < steps.length; i += 1) {
//            for (j = 0;  j < steps[i].maneuver.length; j += 1) {
            // Get the next maneuver.
            let step = steps[i];
            let maneuver = step.maneuver;

            var li = document.createElement('li'),
                    spanArrow = document.createElement('span'),
                    spanInstruction = document.createElement('span');

            //spanArrow.className = 'arrow '  + maneuver.action;
            spanInstruction.innerHTML = maneuver + ", " + step.instructions + ", " + step.distance.text + ", " + step.duration.text;
            li.appendChild(spanArrow);
            li.appendChild(spanInstruction);

            nodeOL.appendChild(li);
//            }
        }

        routeInstructionsContainerGoogle.append(nodeOL);
    }


    // Now use the map as required...
    $(function () {
        $("button#btn_calculate").click(function (event) {
            event.preventDefault();
            cleanUp();
            let start_point = $("#start_lat_lng").val().trim();
            let stop_point = $("#stop_lat_lng").val().trim();
            calculateRouteOfHere(platform, `${start_point}`, `${stop_point}`);
            calculateRouteOfGoogle(`${start_point}`, `${stop_point}`);
            calculateRouteOfSkobbler(`${start_point}`, `${stop_point}`);
        });
        $("button#btn_calculate_pin").click(function (event) {
            event.preventDefault();
            cleanUp();
            let start_point = $("#start_lat_lng_pin").val().trim();
            let stop_point = $("#stop_lat_lng_pin").val().trim();
            if (start_point === "" || stop_point === "") {
                alert("Please click on the map to select start/stop points.");
                return;
            }
            calculateRouteOfHere(platform, `${start_point}`, `${stop_point}`);
            calculateRouteOfGoogle(`${start_point}`, `${stop_point}`);
            calculateRouteOfSkobbler(`${start_point}`, `${stop_point}`);
        });
        $("button#btn_clear_pin").click(function (event) {
            event.preventDefault();
            cleanUp();
            $("#start_lat_lng_pin").val("");
            $("#stop_lat_lng_pin").val("");
            markerGroup.removeAll();
        });
        //CheckBox group
        $('input[type=checkbox][name=cbRoute]').click(function () {
            switch ($(this).attr('id')) {
                case "cbHere" :
                    switchRouteOnMap("Here", $(this).is(':checked'));
                    break;
                case "cbGoogle":
                    switchRouteOnMap("Google", $(this).is(':checked'));
                    break;
                case "cbSkobbler":
                    switchRouteOnMap("Skobbler", $(this).is(':checked'));
                    break;
            }
            console.info($(this).attr('id'));
            console.info($(this).is(':checked'));
        });

    });

    function switchRouteOnMap(routeKey, isShow) {
        let foundedRoute = addedRoute.get(routeKey);
        if (!foundedRoute) {
            console.info(`Not found route for ${routeKey}`);
            return;
        }
        if (isShow) {
            map.addObject(foundedRoute);
            if (routeKey === "Here") {
                addedMarkers.forEach(function (marker) {
                    map.addObject(marker);
                });
            }
        } else {
            removeMapObject(foundedRoute);
            if (routeKey === "Here") {
                addedMarkers.forEach(function (marker) {
                    removeMapObject(marker);
                });
            }
        }
    }

    function cleanUp() {
        let length = addedRoute.size;
        console.info("cleanup for addedRoute "+length);
        console.info(addedRoute.values());
        addedRoute.forEach(function (route) {
            removeMapObject(route);
        });
        addedRoute.clear();
        // Markers
        length = addedMarkers.length;
        for (var i = 0; i < length; i++) {
            let markers = addedMarkers.pop();
            removeMapObject(markers);
        }
    }

    function removeMapObject(mapObject) {
        try {
            map.removeObject(mapObject);
        } catch (err) {
            console.info("Object already not found in map")
        }
    }

    function calculateRouteOfGoogle(startPoint, stopPoint) {
        console.log("calculateRouteOfGoogle");
        console.log(polyline);
        // Set destination, origin and travel mode.
        var request = {
            origin: startPoint,
            destination: stopPoint,
            travelMode: google.maps.TravelMode.DRIVING,
            provideRouteAlternatives: false,
            drivingOptions: {
                //departureTime:  new Date(),
                departureTime: new Date(Date.now() + 3600 * 18),
                trafficModel: google.maps.TrafficModel.OPTIMISTIC
            }
        };
        // Pass the directions request to the directions service.
        var directionsService = new google.maps.DirectionsService();
        directionsService.route(request, function (response, status) {
            if (status == 'OK') {
                // Display the route on the map.
                console.log("===> Google response");
                console.info(response);
                var i = 0;
//                for (var i = 0; i < response.routes.length; i++) {
                let googleEncodedPoints = response.routes[i].overview_polyline;
                console.log(googleEncodedPoints)
                //directionsDisplay.setDirections(response);
                let decodedPoints = polyline.decode(googleEncodedPoints);
                let hereShap = [];
                decodedPoints.forEach(function (point) {
                    hereShap.push(`${point[0]},${point[1]}`);
                });
                console.log("addRouteShapeToMap");

                addRouteShapeToMap(hereShap, googleRouteColor[0], googleRouteWidth, "Google");
                addWaypointsToGooglePanel(response.routes[i].legs[0]);
                addManueversToGooglePanel(response.routes[i].legs[0].steps);
                addSummaryToGooglePanel(response.routes[i].legs[0]);
//                }
            } else {
                alert("Failed to Calcualte Google Route for status " + status);
                console.error(response);
            }
        });

    }
    function calculateGoogleRouteSuccess(data, status) {
        console.log("calculateGoogleRouteSuccess");
        console.log(data);
        if (status != 'success') {
            alert(`Google Service is unavailable now. Status : ${status}`);
            return;
        }
        if (!data) {
            console.log(`Google Service is unavailable now. No Response Data`);
            return;
        }
    }


</script>

<script type="text/javascript">
    var skobKey = skobblerAPIKey;
    let profile = 'carFastest'; // For car: carShortest, carFastest, carEfficient –  carEfficient is a carFastest that makes use of OSM+ driving speeds (i.e. collected from real drivers)
    let command = 'calcroute';
    function calculateRouteOfSkobbler(start, dest) {
        let skobApiUrl = `http://${skobKey}.tor.skobbler.net/tor/RSngx/${command}/json/20_5/en/${skobKey}?start=${start}&dest=${dest}&profile=${profile}&points=yes&advice=yes`;
        $.get(skobApiUrl, handleSkobblerRoute);
    }

    var turnDirections = new Map();
    turnDirections.set(0, "Straight Ahead");
    turnDirections.set(1, "Slight Right");
    turnDirections.set(2, "Slight Left");
    turnDirections.set(3, "Left");
    turnDirections.set(4, "Right");
    turnDirections.set(5, "Hard Right");
    turnDirections.set(6, "Hard Left");
    turnDirections.set(7, "U Turn");
    turnDirections.set(8, "T Street");
    //http://YOUR_API_KEY.tor.skobbler.net/tor/RSngx/command/json/version/locale/YOUR_API_KEY?parameters
    // let start='52.339528,8.980182';
    // let dest='52.876193,8.952722';
    var routeCalcSucceed = 600;
    function handleSkobblerRoute(data, status) {
        console.log("Handling");
        if (status != 'success') {
            alert(`Skobbler Route is unavailable now. Status : ${status}`);
            return;
        }
        if (!data) {
            console.log(`Skobbler Service is unavailable now. No Response Data`);
            return;
        }
        console.info(data);
        if (!data.route || !data.route.status || data.route.status.apiCode !== routeCalcSucceed) {
            alert(`Skobbler Route Calculation Failed.`);
            return;
        }
        let hereShap = [];
        let routePoints = data.route.routePoints;
        routePoints.forEach(function (point) {
            hereShap.push(`${point.y},${point.x}`);
        });
        console.info("addRouteShapeToMap for skobbler");
        addRouteShapeToMap(hereShap, skobblerRouteColor[0], skobblerRouteWidth, "Skobbler");
        addWaypointsToSkobblerPanel(data.route.summary);
        addManueversToSkobblerPanel(data.route.advisor);
        addSummaryToSkobblerPanel(data.route);

    }

    // Add Summary for skobbler MAP
    function addWaypointsToSkobblerPanel(summary) {
        var nodeH3 = document.createElement('h3'), waypointLabels = [], i;

        for (i = 0; i < summary.length; i += 1) {
            waypointLabels.push(summary[i])
        }

        nodeH3.textContent = waypointLabels.join(' -> ');

        routeInstructionsContainerSkobbler.empty();
        routeInstructionsContainerSkobbler.append('<h3 style="color: #FFA500;">Skobbler Map Instructions</h3>');
        routeInstructionsContainerSkobbler.append(nodeH3);
    }

    function addSummaryToSkobblerPanel(route) {
        var summaryDiv = document.createElement('div'),
                content = '';
        content += '<b>Total distance</b>: ' + Math.round(route.routelength) + 'm. <br/>';
        content += '<b>Travel Time</b>: ' + route.duration.toMMSS() + ' (in current traffic)' + ', And ' + route.durationNoTraffic.toMMSS() + '(in No Traffic)';


        summaryDiv.style.fontSize = 'small';
        summaryDiv.style.marginLeft = '5%';
        summaryDiv.style.marginRight = '5%';
        summaryDiv.innerHTML = content;
        routeInstructionsContainerSkobbler.append(summaryDiv);
    }

    function addManueversToSkobblerPanel(advisor) {
        var nodeOL = document.createElement('ol'), i, j;
        nodeOL.style.fontSize = 'small';
        nodeOL.style.marginLeft = '5%';
        nodeOL.style.marginRight = '5%';
        nodeOL.className = 'directions';

        // Add a marker for each maneuver
        for (i = 0; i < advisor.length; i += 1) {
            // Get the next maneuver.
            let step = advisor[i];
            let maneuver = turnDirections.get(step.turnDirection);

            var li = document.createElement('li'),
                    spanArrow = document.createElement('span'),
                    spanInstruction = document.createElement('span');

            //spanArrow.className = 'arrow '  + maneuver.action;
            if (maneuver) {
                spanInstruction.innerHTML = maneuver + ", " + step.instruction
            } else {
                spanInstruction.innerHTML = step.instruction;
            }
            li.appendChild(spanArrow);
            li.appendChild(spanInstruction);

            nodeOL.appendChild(li);
        }

        routeInstructionsContainerSkobbler.append(nodeOL);
    }

</script>

<script src="polyline.js"/>
<script type="text/javascript">


</script>
</body>
</html>